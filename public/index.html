<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat IO</title>

    <script src="/jquery/dist/jquery.js"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <h1>Chat IO</h1>
    <div id="future"></div>
    <form id="connection_form" >
        <input id="port_input" type="text" placeholder="PORT" style="width: 40px;">
        <input id="username_input" type="text" placeholder="Username">
        <input type="submit" value="Connect">
    </form>
    <form id="chat_form">
        <input id="chat_input" type="text">
        <input type="submit" value="Send">
        <input type="button" on-click="disconnect()" value="Disconnect">
    </form>

    <script>

        //get session value for username
        let username = sessionStorage.getItem('username');

        //check if the user is logged in or not
        if(username == null){
            console.log('within if');
            $('#chat_form').hide();
            $('#connection_form').show();
        }else{
            console.log('within else');
            $('#form').show();
            $('#connection_form').hide();
        }

        let socket = null;

        //connect to the server
        let connect = (port, username)=>{
            if(port == null || username == null){
                alert('Please enter both PORT and Username');
            }else{
                socket = io.connect('http://localhost:'.concat(port));
                sessionStorage.setItem('username', username);
            }
        };

        //disconnect from server
        let disconnect = ()=>{
            socket.close();
            sessionStorage.removeItem('username');
        };

        if(socket != null){
            socket.on('connect', (data)=>{
                socket.emit('join', 'Hello World from client!');
            });

            //on event of a broadcasted message
            socket.on('broad', (data)=>{
                $('#future').append(data+"<br/>");
            });
        }

        //send message
        $('#chat_form').submit((e)=>{
            e.preventDefault();
            var message = $('#chat_input').val();
            socket.emit('messages', message);
        });

        //connection form submit
        $('#connection_form').submit((e)=>{
            e.preventDefault();
            connect($('#port_input').val(), $('#username').val());
        })
    </script>
</body>
</html>


